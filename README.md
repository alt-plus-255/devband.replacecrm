# devband.replacecrm

DevBand: ReplaceCrm (Переопределение CRM, СП)

Модуль позволяет определять фабрику, container, router для каждого СП со своим EntityTypeId. 
А также объединять табы в сделка, лидах и СП.

Модуль предназначен для переопределения классов Factory, Container, Router.

В стандартной реализации (в документации) Битрикс предлагает переопределить классы в init.php и работать со всеми сущностями: "Лиды", "Сделки", "Смарт-процессы" там (в файле php_interface/init.php), что приводит к лишним зависимостям и подключению модуля CRM на уровне init.php т.е. везде. 

Данное решение позволит вам как разработчикам разделять классы для разных сущностей в разные модули. 

Например: 
Стоит задача переопределить класс Router для сущности сделки и переопределить класс Container для сущности смарт-процесса с entityTypeId равной 192

Реализация: 
Под каждую сущность вам необходимо создать свой модуль (вместо test указываете название вендора)

1. test.deal
2. test.smart192 (вместо smart192, пишите название вашей сущности смарт-процесса) 

внутри каждого модуля создается файл .settings.php внутри которого пишется след:

1. Для модуля который будет подменять сделку
```php
return [
  'services' => [
    'value' => [
      'replace.crm.service.router.'.\CCrmOwnerType::Deal => new \TEST\Deal\Crm\Service\Router,
    ]
  ]
];
```

2. Для модуля который будет подменять смарт-процесс с entityTypeId = 192
```php
return [
  'services' => [
    'value' => [
      'replace.crm.service.router.'.192 => new \TEST\Smart192\Crm\Service\Container ,
    ]
  ]
];
```

Как вы могли заметить, вам необходимо внутри каждого модуля сделать классы наследующие классы которые вы хотите переопределить.

Также бонусом реализовано событие работы с табами в элементах CRM. По умолчанию битрикс дает подписаться на событие в 1 модуле, если у вас разные модули, которые будут работать с со сделкой и в каждом модуле необходимо вставить свой таб, то используйте событие "merge_onEntityDetailsTabsInitialized" модуля crm, оно позволить выводить табы из нескольких модулей!
